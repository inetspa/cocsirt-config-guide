# ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° KB ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô

### üìã ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Resolve name ‡πÑ‡∏î‡πâ
‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå `/etc/resolve.conf` ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ nameserver ‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏Å‡πá‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
```conf
# Google DNS
nameserver 8.8.8.8
# Cloudflare DNS
nameserver 1.1.1.1
```

### üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GUI Network Management ‡∏Ç‡∏≠‡∏á AlmaLinux 
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Network ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô IP, DNS, Routing ‡∏Ç‡∏≠‡∏á OS
```bash
sudo nmtui
```

### üìã Firewall Fortigate 120G Config NAT ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î Central NAT ‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Config NAT ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Source Interface ‡∏ó‡∏±‡πâ‡∏á Interface Public, Interface Private ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Rule
‡∏Å‡πá‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Policy ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ


### üìã Update AlmaLinux ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤ GPG Invalid ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ bypass ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÑ‡∏î‡πâ
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Bypass gpg check ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô yum ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ parameter ‡∏ß‡πà‡∏≤‡∏≠ `--nogpgcheck`
```bash
sudo yum update --nogpgcheck
```

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà Repository file ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå repo `/etc/yum.repo.d/`

‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ `gpgcheck` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô `0` ‡πÉ‡∏ô repo ‡∏ó‡∏µ‡πà enable ‡πÑ‡∏ß‡πâ


### üìã ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Update CentOS8 ‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠ Update CentOS8 ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Update ‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å
‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å CentOS8 ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£ Support ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Repository location ‡∏õ‡∏¥‡∏î‡πÑ‡∏õ ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å
`http://mirror.centos.org` ‡πÄ‡∏õ‡πá‡∏ô `http://vault.centos.org`

* ‡πÉ‡∏ô repo ‡∏°‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô mirrorlist ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î mirrorlist ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô baseUrl ‡πÅ‡∏ó‡∏ô‡∏î‡πâ‡∏ß‡∏¢

‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 3 files repo ‡∏Ñ‡∏∑‡∏≠
```
# 1 AppStream
/etc/yum.repo.d/CentOS-AppStream.repo

# 2 Base
/etc/yum.repo.d/CentOS-Base.repo

# 3 Extra
/etc/yum.repo.d/CentOS-Extra.repo
```

### üìã Recommend Apache2 configuration
[Config](./WebServer/apache-recommended-config.md)

### üìã ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á XAMP ‡∏ö‡∏ô AlmaLinux
[XAMP](./WebServer/install-xamp-alma9.md)

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á NGINX 1.26.0
[NGINX 1.26.0](./WebServer/nginx-1.26-install.md)

### üìã ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà Apache version (httpd hardening) ‡πÇ‡∏î‡∏ô VA ‡∏û‡∏ß‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà Apache CVE ‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏ï‡∏±‡∏ß
‡πÄ‡∏û‡∏¥‡πà‡∏° config ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á version ‡∏Ç‡∏≠‡∏á httpd ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `/etc/httpd/conf/httpd.conf`
```apache
# Hide version for security reason
ServerTokens Prod
ServerSignature Off
```

### üìã ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏Ç‡∏≠‡∏á PHP Version (php hardening) ‡πÇ‡∏î‡∏ô VA ‡πÄ‡∏à‡∏≠‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà PHP Version ‡πÄ‡∏Å‡πà‡∏≤
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `/etc/php.ini` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ php ‡πÅ‡∏™‡∏î‡∏á version ‡πÑ‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
```apache
# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç expose_php ‡∏à‡∏≤‡∏Å On ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Off
expose_php = Off
```

### üìã ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà Apache CipherSuit strenght ‡πÅ‡∏•‡∏∞ TLS version (Weak Cipher, SWEET32, BLEED)
‡πÄ‡∏û‡∏¥‡πà‡∏° configuration ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `/etc/httpd/conf.d/ssl.conf`
```apache
<IfModule mod_ssl.c>
    # HTTPS Strength Config
    SSLProtocol -All +TLSv1.2 +TLSv1.3
    SSLHonorCipherOrder on
    SSLCompression      off
    SSLSessionTickets   off
    SSLCipherSuite EECDH:EDH:!NULL:!SSLv2:!RC4:!aNULL:!3DES:!IDEA:!SHA1:!SHA256:!SHA384
</IfModule>
```
* ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ Version ‡∏Ç‡∏≠‡∏á Apache ‡∏î‡πâ‡∏ß‡∏¢ ‡∏´‡∏≤‡∏Å Apache version 2.2 ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö TLSv1.x ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏à‡∏∞ Error ‡πÑ‡∏î‡πâ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Apache version 2.4 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ
* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç config ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡∏£‡∏±‡∏ô `sudo httpd -t` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö configuration compatible ‡∏î‡πâ‡∏ß‡∏¢ ‡∏´‡∏≤‡∏Å‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ

### üìã ‡πÄ‡∏û‡∏¥‡πà‡∏° Security header ‡∏Ç‡∏≠‡∏á apache ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ XSS ‡πÅ‡∏•‡∏∞ IFrame
‡πÄ‡∏û‡∏¥‡πà‡∏° configuration ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `/etc/httpd/conf/httpd.conf`
```apache
# Security Header
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set X-Content-Type-Options "nosniff"
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
```

### üìã Enable Http/2.0 ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö Apache
‡πÄ‡∏û‡∏¥‡πà‡∏° code ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `/etc/httpd/conf.d/ssl.conf`
```apache
<IfModule mod_ssl.c>
    # Enable HTTP/2
    Protocols h2 http/1.1
</IfModule>
```

### üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö update os linux
- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Ubuntu, Debian
```bash
sudo apt update
sudo apt upgrade -y

# Ubuntu ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á upgrade ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Security ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ Security package ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÑ‡∏´‡∏°‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢
# 1. Refresh update list
sudo apt update
# 2. Show security update list
sudo apt list --upgradable 2>/dev/null | grep "\-security"
# 3. Install security update list
sudo apt list --upgradable 2>/dev/null | grep "\-security" | awk -F " " {'print $1'} | awk -F "," {'print $1'} | sudo xargs apt install --only-upgrade -y

# ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á
```

- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CentOS, AlmaLinux, RockyLinux
```bash
sudo yum update -y

# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö update ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Security patch update
sudo yum udpate --security -y
```

### üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Port ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÅ‡∏•‡∏∞ Process ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Port ‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà
```bash
sudo netstat -lnp
```

### üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Interface ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Linux
```bash
sudo ifconfig
```
*‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á Install `sudo yum install net-tools` ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Ubuntu ‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `sudo apt install net-tools`

### üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Linux ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sniff packet
```bash
# ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á tcpdump ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏°‡∏µ parameter ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
# 1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Interface
# -i <interface>
#
# 2. ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Resovle name n 1 ‡∏ï‡∏±‡∏ß = ‡πÑ‡∏°‡πà resolve ip, n 2 ‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á resolve port
# -nnn
#
# 3. Filter protocol ‡πÄ‡∏ä‡πà‡∏ô
# tcp
#
# 4. Filter port ‡πÄ‡∏ä‡πà‡∏ô
# port 443
#
# 5. Filter ip
# host 192.168.1.1
# src 192.168.1.1
# dst 192.168.1.1

# Example #1
# ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Sniff ‡∏î‡∏π‡∏ß‡πà‡∏≤ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Web HTTP ‡∏à‡∏≤‡∏Å IP 10.0.1.20 ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏µ‡πà Server ‡∏ó‡∏µ‡πà Interface eth0 ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏Å‡πá‡∏à‡∏∞‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ
sudo tcpdump -i eth0 -nnn tcp port 80 and src 10.0.1.20

# Example #2
# ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Sniff ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Server ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á DNS ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 8.8.8.8 ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡πà‡∏≤‡∏ô Interface ens192 ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
sudo tcpdump -i ens192 -nnn udp port 53 and dst 8.8.8.8

# Example #3
# ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Sniff ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ packet ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Server ‡πÑ‡∏õ‡∏´‡∏≤ IP 192.168.1.30 ‡∏ú‡πà‡∏≤‡∏ô Interface eth1 ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
sudo tcpdump -i eth1 -nnn host 192.168.1.30
```

### üìã Web ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö HTTPS ‡πÅ‡∏•‡∏∞ Security ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
- [SSL LAB](https://www.ssllabs.com/ssltest/) ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö A ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ
- [Security Header](https://securityheaders.com/) ‡∏Ñ‡∏ß‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö A ‡∏Ç‡∏∂‡πâ‡∏ô (‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ)

### üìã ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Ciphersuite ‡πÅ‡∏•‡∏∞ Hash algorithm ‡∏Ç‡∏≠‡∏á Windows Server, IIS, MSSQL (SWEET32)
‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà Registry ‡∏Ç‡∏≠‡∏á OS
1. ‡πÄ‡∏õ‡∏¥‡∏î `Registry Editor` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `regedit`
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\Triple DES 168`
3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ key ‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á key ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£ Click ‡∏Ç‡∏ß‡∏≤ ‡∏ó‡∏µ‡πà `Ciphers` ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `New -> Key` ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `Triple DES 168` 
4. ‡∏™‡∏£‡πâ‡∏≤‡∏á `DWORD` ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `Enabled` ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô `0`

![Fixed_SWEET32](./assets/sweet32fixed.png)

<!-- ![Windows Registry](./assets/windows_sweet32.png "SWEET32") -->

‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£ Download program ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ IIS Crypto ‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠ Config ‡∏ú‡πà‡∏≤‡∏ô GUI ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà [Download](https://www.nartac.com/Products/IISCrypto/Download)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° `Best Practices`

![Nartac GUI](./assets/nartac_iis_crypto.png)

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡πâ ‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏´‡πâ Click ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏≠‡∏≠‡∏Å‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ `Apply`

- Server Protocols
    - Uncheck `TLS 1.0`
    - Uncheck `TLS 1.1`

- Client Protocols
    - Uncheck `TLS 1.0`
    - Uncheck `TLS 1.1`

- Ciphers
    - Uncheck `Triple DES 168`

- Hashes
    - Uncheck `MD5`
    - Uncheck `SHA`


### üìã Import OVA CentOS7 ‡∏à‡∏≤‡∏Å VirtualBox ‡πÄ‡∏Ç‡πâ‡∏≤ Promox ‡πÅ‡∏•‡πâ‡∏ß Boot ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Dracut
‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô Boot ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Grub ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Boot ‡∏≠‡∏±‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `Rescue` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Boot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î Terminal ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠ regenerate dracut ‡πÉ‡∏´‡∏°‡πà

```bash
sudo dracut --regenerate-all --force
```

‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Reboot ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πá‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥

Cr. https://forums.centos.org/viewtopic.php?t=63988&start=10

### üìã ‡∏Å‡∏≤‡∏£ Convert File Cert PEM ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Format ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Windows (.pfx)

‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ
1. ‡πÑ‡∏ü‡∏•‡πå Cert ‡πÄ‡∏ä‡πà‡∏ô abc.crt
2. ‡πÑ‡∏ü‡∏•‡πå Key ‡πÄ‡∏ä‡πà‡∏ô key.pem
3. CA Intermediate Cert ‡πÑ‡∏ü‡∏•‡πå ca.crt
4. ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå pfx

‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Convert ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£ Conert ‡∏à‡∏≤‡∏Å pem ‡πÄ‡∏õ‡πá‡∏ô pkcs12
```bash
# Convert pem to pfx
openssl pkcs12 -inkey <private_key_file> -in <cert_file> -certfile <ca_cert_file> -export -out <output_pfx_file>
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô
```bash
openssl pkcs12 -inkey abc.pem -in abc.crt -certfile ca.crt -export -out abc.pfx
```
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÉ‡∏™‡πà Password ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö pfx ‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå output ‡∏ä‡∏∑‡πà‡∏≠ `abc.pfx` ‡∏°‡∏≤

‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ `abc.pfx` ‡πÑ‡∏õ import ‡πÉ‡∏ô IIS ‡∏ö‡∏ô Windows ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Password ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏≠‡∏ô Convert ‡∏°‡∏≤
‡∏Å‡πá‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Cert ‡πÑ‡∏î‡πâ

Cr. https://www.sslshopper.com/ssl-converter.html

### üìã ‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ NMAP scan ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏à‡∏≠ port TCP/2000 ‡∏´‡∏£‡∏∑‡∏≠ TCP/5060 ‡∏ó‡∏µ‡πà Firewall Fortigate

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà Scan ‡πÄ‡∏à‡∏≠ ‡∏à‡∏∞‡∏û‡∏ö 2 ports ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

![NMAP Scan](./assets/nmap-sccp.jpg)

‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô SIP ‡πÅ‡∏•‡∏∞ Cisco CSSP
‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡∏õ‡∏¥‡∏î ‡∏ó‡∏µ‡πà Firewall ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Command line ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

![Disable SIP/SCCP](./assets/sip-sccp.jpg)


### üìã ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Apache Allow `path` ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á IP ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ 2 ‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á Config ‡∏ó‡∏µ‡πà vhost ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà .htaccess ‡∏Ç‡∏≠‡∏á url ‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° config ‡∏•‡∏á‡πÑ‡∏õ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

```apache
<Location "/location/">  
    AllowOverride None  
    Order Deny,Allow  
    Deny from All
    # ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Allow IP ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    Allow from 10.10.10.10
    Allow from 10.10.1.0/24
</Location>

<Location "/location/sub">  
    Allow from All
</Location>
```

### üìã ‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° WinSCP ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Upload files ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå root

‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤ Enable PAM ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î user `root` ‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏µ‡∏° Dev ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ Program WinSCP Upload file ‡πÄ‡∏ß‡πá‡∏ö ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Upload ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ User ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Dir ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡∏¥‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Permission ‡∏Ç‡∏≠‡∏á Files ‡πÅ‡∏•‡∏∞ Dir

![Permission](./assets/winscp01.png)

‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ WinSCP ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Upload file ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Dir ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå `root` ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Upload ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Home ‡πÅ‡∏•‡πâ‡∏ß SSH ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡∏¢‡πâ‡∏≤‡∏¢ File ‡πÑ‡∏õ Dir ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö 777 ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

***‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏*** ‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ user ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô group `sudo` ‡πÉ‡∏ô ubuntu ‡∏´‡∏£‡∏∑‡∏≠ group `wheel` ‡πÉ‡∏ô centos, almalinux ‡∏´‡∏£‡∏∑‡∏≠ group ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `sudo` ‡πÑ‡∏î‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô !!!

#### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏∑‡∏≠ 
- Debian, Ubuntu
‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Debian ‡∏à‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡πÇ‡∏î‡∏¢
1. ‡∏ï‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Connection ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Advance > SFTP` ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÄ‡∏≠‡∏≤ Command ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ
```
sudo su -c /usr/lib/openssh/sftp-server
```
![advance](./assets/winscp02.png)

2. ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πá Connect ‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Å‡πá‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå `root` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Upload files ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏î‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠ Upload file ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ Owner ‡πÄ‡∏õ‡πá‡∏ô `root`

![accessed](./assets/winscp03.png)

- CentOS, AlamaLinux
‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏¢ Red Hat ‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡∏Ñ‡∏∑‡∏≠ ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Execute ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SFTP Server ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Password ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Group `Wheel` ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

1. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ SSH ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Server ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå `sudo vi /etc/sudoers`

```
# Allow sudo with WinSCP
%wheel ALL=NOPASSWD:/usr/libexec/openssh/sftp-server
```

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá Exit ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Server ‡πÑ‡∏î‡πâ

2. ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° WinSCP ‡∏™‡∏£‡πâ‡∏≤‡∏á Connection ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Advance > SFTP` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á Ubuntu ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏≠‡∏≤ Command ‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á SFTP server

```
sudo /usr/libexec/openssh/sftp-server
```

![config](./assets/winscp04.png)

3. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Connect ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÇ‡∏î‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å upload ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏Å‡πá‡∏à‡∏∞‡∏°‡∏µ Owner ‡πÄ‡∏õ‡πá‡∏ô `root` ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ upload file ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á server ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå `root` ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß

![root](./assets/winscp05.png)

### üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CPU Process ‡∏ö‡∏ô Firewall Fortigate ‡∏´‡∏≤‡∏Å‡πÄ‡∏à‡∏≠ High CPU Usage

* ‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CPU ‡∏™‡∏π‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å `enable send syslog` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Firewall `Fortigate 61E v6.0.5` ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ Upgrade ‡πÑ‡∏õ `v6.4.8` ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ (Note. ‡πÑ‡∏î‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö `v7.2.8` ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CPU ‡∏™‡∏π‡∏á‡∏´‡∏•‡∏±‡∏á enable send syslog)

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Diag ‡∏î‡∏π Process
``` bash
# Show top processes information
diagnose sys top

# Show top threads information
diagnose sys top-all
```

‡∏´‡∏≤‡∏Å‡∏û‡∏ö Process ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ
- miglogd => ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á syslog ‡∏•‡∏≠‡∏á‡πÑ‡∏•‡πà‡∏î‡∏π Configuration ‡∏ó‡∏µ‡πà Log setting ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î Send syslog ‡∏î‡∏π‡∏ß‡πà‡∏≤ CPU ‡∏•‡∏î‡∏•‡∏á‡πÑ‡∏´‡∏°
- ips => ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö UTM ‡πÉ‡∏ô Policy ‡∏≠‡∏≤‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô IPS ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á Policy

### üìã ‡πÅ‡∏Å‡πâ Cert MSSQL Weak self signed use SHA1 hash

‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å Cert ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á MSSQLSERVER ‡πÉ‡∏ä‡πâ `SHA1` ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô weak hash algorithm ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `SHA256` ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ

1. Generate Self signed cert ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÉ‡∏ä‡πâ Program ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡πà‡∏≤‡∏ô `openssl` command line ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞ Convert ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `openssl`
```bash
openssl req -x509 -newkey rsa:4096 \
 -sha256 -days 3650 -nodes \
 -keyout selfsigned.key \
 -out selfsigned.crt \
 -subj "/CN=___WINDOWS_HOSTNAME___"
```
‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ `___WINDOWS_HOSTNAME___` ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á SQL Server ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡∏û‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤ 2 ‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏∑‡∏≠ Private Key file `selfsigned.key` ‡πÅ‡∏•‡∏∞ Cert file `selfsigned.crt`

2. ‡πÅ‡∏õ‡∏•‡∏á Self signed cert ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Format `PEM` ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö format ‡∏Ç‡∏≠‡∏á `pfx` ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Windows
```bash
openssl pkcs12 -inkey selfsigned.key -in selfsigned.crt -export -out selfsigned.pfx
```
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå `selfsigned.pfx` ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤

3. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Import file `selfsigned.pfx` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Windows
 - ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏î `Win+R` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î run command
 - ‡∏û‡∏¥‡∏°‡∏û‡πå `mmc` ‡πÅ‡∏•‡∏∞‡∏Å‡∏î enter
 - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏£‡∏á `Personal` ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `import`
 - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå `pfx` ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ convert ‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 2

![Cert import](./assets/win-cert-import.png)

4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡πâ User ‡∏Ç‡∏≠‡∏á SQL Server ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Cert ‡πÑ‡∏î‡πâ
 - ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà Cert ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ import ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `All Tasks` > `Manage Private Keys...`

![Cert manage](./assets/win-cert-manage.png)
 
 - ‡πÄ‡∏û‡∏¥‡πà‡∏° User `NT USER\MSSQLSERVER` ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Read

![Cert Perm](./assets/win-cert-perm.png)

5. Apply Cert ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà import ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡πâ SQL Server ‡πÉ‡∏ä‡πâ
 - ‡πÄ‡∏õ‡∏¥‡∏î `SQL Server Configuration Manager` ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà `Protocol for MSSQLSERVER` ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤ ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `Properties`

![SQL Prop](./assets/win-sql-prop.png)

 - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å tab `Certificate` ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Cert ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏î `OK` ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Restart SQL Server ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

![SQL Cert](./assets/win-sql-cert.png)

*Credit: https://virtual-dba.com/blog/upgrading-sha1-certificate-sql-server/*